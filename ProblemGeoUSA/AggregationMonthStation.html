<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script type="text/javascript" src="../libs/jquery-1.11.0.min.js"></script>
<script src="../libs/FileSaver.js"></script>

<div id="vis"></div>


<script>
//change/clean up when have clarification on data format to output, currently
//not separating by month, only id.
var reducedDataSet={ month:[] };

    d3.json("../data/allData2003_2004.json",function(error,data){
       
       // var allDates = [];
        var allTimes =[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,];
        var timeParser = d3.time.format("%b %_d, %Y %X %p");
       var keys = Object.keys(data);
       var trail =[690150, 690230];

		
		
		//keys.forEach(function(d, i){
		trail.forEach(function(d, i){
			//var d=690150;
			reducedDataSet.month[d]={};
			var sum =0;
			data[d].map(function(e, j){
				//use this with array for each month if need to separate that way..
				//if(timeParser.parse(e.date).getMonth() == 1){
					sum = sum+parseInt(e.value);
					for(f=0; f<=23; f++){
						if((timeParser.parse(e.date).getHours())==f){
							var h = parseInt(allTimes[f])+parseInt(e.value);
							allTimes[f] = h;
						}
						
						reducedDataSet.month[d]={"sum": sum,
						"hourly":{ "01:00:00 AM": allTimes[1], "02:00:00 AM": allTimes[2],
						"03:00:00 AM": allTimes[3], "04:00:00 AM": allTimes[4],
						"05:00:00 AM": allTimes[5], "06:00:00 AM": allTimes[6],
						"07:00:00 AM": allTimes[7], "08:00:00 AM": allTimes[8], 
						"09:00:00 AM": allTimes[9], "10:00:00 AM": allTimes[10],
						"11:00:00 AM": allTimes[11], "12:00:00 PM": allTimes[12], 
						"13:00:00 PM": allTimes[13], "14:00:00 PM": allTimes[14],
						"15:00:00 PM": allTimes[15], "16:00:00 PM": allTimes[16], 
						"17:00:00 PM": allTimes[17], "18:00:00 PM": allTimes[18],
						"19:00:00 PM": allTimes[19], "20:00:00 PM": allTimes[20], 
						"21:00:00 PM": allTimes[21], "22:00:00 PM": allTimes[22],
						"23:00:00 PM": allTimes[23], "00:00:00 AM": allTimes[0],}};
					}
				//}
       			
       		
       		//});
			//console.log(allTimes);
		});
		});
		
		console.log(reducedDataSet);
	
		saveToFile(reducedDataSet.month,"reducedMonthStationHour2003_2004.json");
    });

	
	
    var saveToFile = function(object, filename){
    	console.log(object);
    	var o = object
    	//var jsonString = object.toString();
        var blob, blobText;
        blobText = [JSON.stringify(o, null, 2)];
        console.log(blobText);
        blob = new Blob(blobText, {
            type: "text/plain;charset=utf-8"
        });
        saveAs(blob, filename);
    }


</script>


</body>
</html>